@page "/Pago"
@inject TarjetasService tarjetas
@inject PresupuestosService presupuestoService

<section style="background-color: #eee;">
  <EditForm Model="pago">
  <div class="container py-5">
    <div class="card">
      <div class="card-body">
        <div class="row d-flex justify-content-center pb-5">
          <div class="col-md-7 col-xl-5 mb-4 mb-md-0">
            <div class="py-4 d-flex flex-row">
              <h5><span class="far fa-check-square pe-2"></span><b>PLANIFY</b> |</h5>
              <span class="ps-2">Pago</span>
            </div>
            <h4>Realiza tu pago</h4>
            <div class="rounded d-flex bg-body-tertiary">
            </div>
            <hr/>
            <h4>Tus Articulos</h4>
            <table class="tabla-sin-lineas">
              <thead>
              <tr>
                <th>Artículo</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Precio Total</th>
              </tr>
              </thead>
              <tbody>
              @foreach (var articulo in detalle)
              {
                <tr>
                  <td>@articulo.Articulo.Nombre</td>
                  <td>@articulo.Cantidad</td>
                  <td class="text-lg-start">$@articulo.Articulo.Precio</td>
                  <td>$@((articulo.Articulo.Precio * articulo.Cantidad).ToString("N2"))</td>
                </tr>
              pago.Monto += articulo.Articulo.Precio * articulo.Cantidad;
              }
              </tbody>
            </table>
            <hr/>
            <div class="pt-2">
              <div class="d-flex pb-2">
                <div class="ms-auto">
                </div>
              </div>
              <form class="pb-3">
                <div class="d-flex flex-row pb-3">
                  <h4>Selecciona tu Tarjeta</h4>
                </div>
                <InputRadioGroup @bind-Value="pago.TarjetaId">
                  @foreach (var tarjeta in ListaTarjetas)
                  {
                  <div class="tarjeta-container">
                    <div class="tarjeta-info">
                      @if (tarjeta.Banco == "Mastercard")
                      {
                      <img src="https://res.cloudinary.com/drjm09rqf/image/upload/v1743556867/Mastercard-Logo-PNG-HD-1_asmjkb.webp" alt="Logo Mastercard" class="tarjeta-logo">
                      }
                      else if (tarjeta.Banco == "Visa")
                      {
                      <img src="https://res.cloudinary.com/drjm09rqf/image/upload/v1743557099/download-visa-card-logo-icon-png-735811696866915avdywnhoab_o46s2o.png" alt="Logo Visa" class="tarjeta-logo">
                      }
                      else
                      {
                      <img src="https://res.cloudinary.com/drjm09rqf/image/upload/v1743557212/524369-200_uvpsk6.png" alt="Logo Desconocido" class="tarjeta-logo">
                      }
                      <span class="tarjeta-numero">@tarjeta.ApodoTarjetaCredito</span>
                    </div>
                    <InputRadio class="form-check-input"
                                Value="@pago.TarjetaId"/>
                  </div>
                  }
                </InputRadioGroup>
              </form>
              <input type="button" value="Proceder al Pago" data-mdb-ripple-init class="btn btn-primary btn-block btn-lg"/>
            </div>
          </div>

          <div class="col-md-5 col-xl-4 offset-xl-1">
            <div class="py-4 d-flex justify-content-end">
              <h6><a href="/">Cancelar y volver</a></h6>
            </div>
            <div class="rounded d-flex flex-column p-2 bg-body-tertiary">
              <div class="p-2 me-3">
                <h4>Tu Orden</h4>
              </div>
              <div class="p-2 d-flex">
                <div class="col-8">Subtotal</div>
                <div class="ms-auto">$@pago.Monto.ToString("N2")</div>
              </div>
              <div class="p-2 d-flex">
                <div class="col-8">ITBIS</div>
                @{
                  var Itbis = pago.Monto * 0.18;
                }
                <div class="ms-auto">+@Itbis.ToString("N2") </div>
              </div>
              <div class="p-2 d-flex">
                <div class="col-8">Envío</div>
                <div class="ms-auto">+ $250.00</div>
              </div>
              <div class="border-top px-2 mx-2"></div>
              <div class="border-top px-2 mx-2"></div>
              <div class="border-top px-2 mx-2"></div>
              <div class="p-2 d-flex pt-3">
                <div class="col-8"><b>Total</b></div>
                @{
                  var Total = pago.Monto + 250 + Itbis;
                }
                <div class="ms-auto"><b class="text-success">$@Total.ToString("N2")</b></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </EditForm>
</section>

@code{

  public int TarjetaSeleccionada { get; set; }
  public Pagos pago { get; set; } = new Pagos();
  public List<TarjetasCredito> ListaTarjetas { get; set; } = new List<TarjetasCredito>();
  public List<PresupuestosDetalle> detalle { get; set; } = new List<PresupuestosDetalle>();
  

  protected override async Task OnInitializedAsync()
  {
    detalle = await presupuestoService.ListarDetalle(p => p.PresupuestoId == 52);
    ListaTarjetas = await tarjetas.Listar(t => t.TarjetaId > 0);
  }

}